#!/usr/bin/env melodium
#! name = fs_test
#! version = 0.7.1
#! require = flow:0.7.1
#! require = engine:0.7.1
#! require = conv:0.7.1
#! require = fs:0.7.1

use engine/util::startup
use flow::generate
use flow::count
use conv::toBytes
use flow/vec::flatten
use flow::emit
use fs/file::write

treatment main() {
    
    startup()
    emitLength: emit<u128>(value=128000)
    generate<void>(data = _)
    
    startup.trigger -> emitLength.trigger,emit -> generate.length
    
    count<void>()
    toBytes<u128>()
    flatten<byte>()
    
    generate.stream -> count.stream,count -> toBytes.value,data -> flatten.vector
    
    emit<string>(value="./fs_try.data")
    write()
    
    startup.trigger -> emit.trigger,emit -> write.path
    flatten.value -> write.data
    
}
